<div class="cad-backdrop" (click)="onBackdropClick($event)">
  <div class="cad-dialog">

    <!-- ── Header ── -->
    <div class="cad-header">
      @if (step() === 2) {
        <button class="cad-back-btn" (click)="goBack()" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
          </svg>
        </button>
      }
      <h2 class="cad-title">
        @if (step() === 1) {
          Connect Account
        } @else {
          Connect {{ selectedPlatform()?.label }}
        }
      </h2>
      <button class="cad-close-btn" (click)="close.emit()" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
          <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
        </svg>
      </button>
    </div>

    <!-- ── Step 1: Platform Selection ── -->
    @if (step() === 1) {
      <div class="cad-body">
        <p class="cad-hint">Select a platform to connect:</p>
        <div class="cad-platform-grid">
          @for (p of platforms; track p.type) {
            <button
              class="cad-platform-btn"
              [style.--platform-color]="p.color"
              (click)="selectPlatform(p)"
              type="button"
            >
              <span class="cad-platform-icon" [style.background]="p.color">
                {{ p.label.charAt(0) }}
              </span>
              <span class="cad-platform-label">{{ p.label }}</span>
            </button>
          }
        </div>
      </div>
    }

    <!-- ── Step 2: Account Details ── -->
    @if (step() === 2) {
      <div class="cad-body">
        <label class="cad-label" for="accountId">Account ID</label>
        <input
          id="accountId"
          class="cad-input"
          type="text"
          placeholder="e.g. @yourhandle or numeric ID"
          [ngModel]="accountId()"
          (ngModelChange)="accountId.set($event)"
        />

        <label class="cad-label" for="displayName">Display Name</label>
        <input
          id="displayName"
          class="cad-input"
          type="text"
          placeholder="e.g. My Brand Account"
          [ngModel]="displayName()"
          (ngModelChange)="displayName.set($event)"
        />

        <label class="cad-label" for="accessToken">Access Token</label>
        <input
          id="accessToken"
          class="cad-input"
          type="password"
          placeholder="Paste your access token"
          [ngModel]="accessToken()"
          (ngModelChange)="accessToken.set($event)"
        />

        <label class="cad-label" for="refreshToken">
          Refresh Token <span class="cad-optional">(optional)</span>
        </label>
        <input
          id="refreshToken"
          class="cad-input"
          type="password"
          placeholder="Paste refresh token if applicable"
          [ngModel]="refreshToken()"
          (ngModelChange)="refreshToken.set($event)"
        />
      </div>

      <div class="cad-footer">
        <button class="cad-btn cad-btn--cancel" (click)="close.emit()" type="button">Cancel</button>
        <button
          class="cad-btn cad-btn--connect"
          (click)="onConnect()"
          [disabled]="!isFormValid() || saving()"
          type="button"
        >
          @if (saving()) {
            Connecting...
          } @else {
            Connect
          }
        </button>
      </div>
    }

  </div>
</div>
