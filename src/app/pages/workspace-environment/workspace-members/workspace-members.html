<!-- ── Header ── -->
<div class="wm-header">
  <div>
    <h1 class="wm-title">Members</h1>
    <p class="wm-subtitle">Manage who has access to this workspace and their roles.</p>
  </div>
  <button class="btn wm-btn-invite" (click)="showInviteDialog.set(true)">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
      <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
    </svg>
    Invite member
  </button>
</div>

<!-- ── Members table ── -->
<div class="wm-card">
  <div class="wm-table-head">
    <span class="wm-th wm-th--user">User</span>
    <span class="wm-th wm-th--role">Role</span>
    <span class="wm-th wm-th--joined">Joined</span>
    <span class="wm-th wm-th--actions"></span>
  </div>

  <!-- Owner row -->
  @if (workspace()?.ownerId) {
    <div class="wm-row">
      <div class="wm-cell wm-cell--user">
        <span class="wm-avatar">O</span>
        <div class="wm-user-info">
          <span class="wm-user-name">{{ workspace()!.ownerId }}</span>
          <span class="wm-user-email">Owner</span>
        </div>
      </div>
      <div class="wm-cell wm-cell--role">
        <span class="wm-role-badge wm-role-badge--owner">Owner</span>
      </div>
      <div class="wm-cell wm-cell--joined">
        <span class="wm-date">{{ formatDate(workspace()!.createdAt) }}</span>
      </div>
      <div class="wm-cell wm-cell--actions">
        <span class="wm-actions-placeholder">—</span>
      </div>
    </div>
  }

  <!-- Member rows -->
  @for (member of workspace()?.members; track member.userId) {
    <div class="wm-row">
      <div class="wm-cell wm-cell--user">
        <span class="wm-avatar wm-avatar--blue">{{ getInitials(member.userId) }}</span>
        <div class="wm-user-info">
          <span class="wm-user-name">{{ member.userId }}</span>
          <span class="wm-user-email">{{ member.role }}</span>
        </div>
      </div>
      <div class="wm-cell wm-cell--role">
        <span class="wm-role-badge" [class]="'wm-role-badge wm-role-badge--' + member.role">
          {{ member.role }}
        </span>
      </div>
      <div class="wm-cell wm-cell--joined">
        <span class="wm-date">{{ formatDate(member.joinedAt) }}</span>
      </div>
      <div class="wm-cell wm-cell--actions">
        @if (isOwner()) {
          <button class="wm-action-btn wm-action-btn--remove" title="Remove member" (click)="onRemoveMember(member.userId)">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
            </svg>
          </button>
        }
      </div>
    </div>
  } @empty {
    @if (!workspace()?.ownerId) {
      <div class="wm-empty">No members yet. Invite someone to get started.</div>
    }
  }
</div>

<!-- ── Roles legend ── -->
<div class="wm-legend-card">
  <h2 class="wm-legend-title">Role Permissions</h2>
  <div class="wm-legend-grid">
    <div class="wm-legend-item">
      <span class="wm-role-badge wm-role-badge--owner">Owner</span>
      <span class="wm-legend-desc">Full access. Can manage billing, delete workspace, and transfer ownership.</span>
    </div>
    <div class="wm-legend-item">
      <span class="wm-role-badge wm-role-badge--admin">Admin</span>
      <span class="wm-legend-desc">Can manage members, settings, and all content within the workspace.</span>
    </div>
    <div class="wm-legend-item">
      <span class="wm-role-badge wm-role-badge--manager">Manager</span>
      <span class="wm-legend-desc">Can create, edit, and publish posts. Cannot manage members or settings.</span>
    </div>
    <div class="wm-legend-item">
      <span class="wm-role-badge wm-role-badge--member">Member</span>
      <span class="wm-legend-desc">Can view content and create draft posts. Limited editing permissions.</span>
    </div>
  </div>
</div>

<!-- ── Invite dialog ── -->
@if (showInviteDialog()) {
  <app-invite-dialog
    [workspaceId]="workspace()!.id"
    (close)="showInviteDialog.set(false)"
  />
}
